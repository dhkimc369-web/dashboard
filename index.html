<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì œì¡°íŒ€ ì—…ë¬´ ê²Œì‹œíŒ (ì´ë¯¸ì§€/í˜„í™©íŒ ê°•í™”í˜•)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f1f5f9; height: 100vh; display: flex; flex-direction: column; overflow: hidden; font-family: 'Pretendard', sans-serif; }
        .main-container { display: flex; flex: 1; gap: 15px; padding: 15px; width: 100%; box-sizing: border-box; }
        .column { display: flex; flex-direction: column; gap: 15px; }
        .card { background: white; border-radius: 12px; border: 1px solid #e2e8f0; padding: 15px; display: flex; flex-direction: column; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow: hidden; }
        .card-title { font-size: 1.3rem; font-weight: 800; border-bottom: 2px solid #f1f5f9; padding-bottom: 8px; margin-bottom: 10px; }
        
        .scroll-box { flex: 1; overflow-y: auto; position: relative; background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; scrollbar-width: thin; }
        .scroll-box::-webkit-scrollbar { width: 4px; }
        .scroll-box::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }

        .scroll-content { padding: 12px; font-size: 1.15rem; line-height: 1.6; color: #1e293b; font-weight: 500; white-space: pre-wrap; position: relative; }
        .animate-scroll { animation: scrollLoop 20s linear infinite alternate; }
        .scroll-box:hover .animate-scroll { animation-play-state: paused; }
        @keyframes scrollLoop { 0% { transform: translateY(0); } 100% { transform: translateY(calc(-100% + 150px)); } }

        /* ì´ë¯¸ì§€ ì¶œë ¥ ì „ìš© ìŠ¤íƒ€ì¼ */
        .status-img { width: 100%; height: auto; border-radius: 4px; object-fit: contain; }

        /* ìƒë‹¨ íš¨ê³¼ ë° ì•ŒëŒ */
        .ot-box { display: flex; flex-direction: column; align-items: center; background: #334155; padding: 5px; border-radius: 8px; width: 95px; position: relative; }
        .ot-input { width: 100%; height: 40px; background: white; color: black; font-size: 1.8rem; font-weight: 900; text-align: center; border: 2px solid #fbbf24; border-radius: 6px; outline: none; }
        .max-highlight { transform: scale(1.1); background: #7c3aed !important; box-shadow: 0 0 20px #fbbf24; }
        .max-highlight::after { content: 'ğŸ‰'; position: absolute; top: -15px; font-size: 1.5rem; animation: firework 0.8s infinite alternate; }
        @keyframes firework { 0% { transform: translateY(0); } 100% { transform: translateY(-10px); } }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .marquee-container { flex: 1; margin: 0 40px; overflow: hidden; white-space: nowrap; }
        .marquee-text { display: inline-block; font-size: 1.6rem; font-weight: 700; color: #fbbf24; animation: marquee 15s linear infinite; }
        #alertBanner { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; background: rgba(239, 68, 68, 0.98); color: white; padding: 60px; border-radius: 30px; text-align: center; font-size: 5.5rem; font-weight: 900; z-index: 2000; box-shadow: 0 0 150px rgba(0,0,0,0.7); animation: blink 0.8s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body>

    <div id="alertBanner">ë©”ì‹œì§€ ì•ŒëŒ</div>

    <header class="flex justify-between items-center bg-[#1e293b] text-white p-5 shadow-xl">
        <div style="min-width: 380px;">
            <h1 class="text-3xl font-black text-[#fbbf24]">ì œì¡°íŒ€ ì—…ë¬´ ê²Œì‹œíŒ</h1>
            <div id="clockDisplay" class="text-xl font-bold text-slate-300 mt-1">ë¡œë”© ì¤‘...</div>
        </div>
        <div class="marquee-container">
            <div id="scrollingNotice" class="marquee-text">í˜„ì¥ ë°ì´í„° ë™ê¸°í™” ì¤‘...</div>
        </div>
        <div class="flex items-center gap-4">
            <div class="flex gap-3 bg-[#0f172a] p-3 rounded-lg border border-slate-700 items-center">
                <span class="text-sm font-black text-[#fbbf24] mr-2">ğŸŒ™ ì—°ì¥ ì¸ì›</span>
                <div id="box-otBBT" class="ot-box"><span class="text-[11px] text-white mb-1 font-bold">BBT</span><input type="text" id="otBBT" class="ot-input" readonly></div>
                <div id="box-otInsert" class="ot-box"><span class="text-[11px] text-white mb-1 font-bold">ì¸ì„œíŠ¸</span><input type="text" id="otInsert" class="ot-input" readonly></div>
                <div id="box-otRetouch" class="ot-box"><span class="text-[11px] text-white mb-1 font-bold">ë¦¬í„°ì¹˜</span><input type="text" id="otRetouch" class="ot-input" readonly></div>
            </div>
        </div>
    </header>

    <div class="main-container flex-col">
        <div class="flex flex-1 gap-4" style="height: 65%;">
            <div class="column w-1/3">
                <div class="card h-1/2"><h2 class="card-title text-red-500">ğŸ“¢ ê³µì§€ ì‚¬í•­</h2><div class="scroll-box"><div id="notice" class="scroll-content"></div></div></div>
                <div class="card h-1/2"><h2 class="card-title text-blue-500">ğŸ‘¥ ê·¼íƒœ í˜„í™©</h2><div class="scroll-box"><div id="attendance" class="scroll-content"></div></div></div>
            </div>
            <div class="column w-1/3">
                <div class="card h-full border-t-[6px] border-blue-500"><h2 class="card-title text-blue-600 italic">âœ… ì—…ë¬´ ê³µìœ </h2><div class="scroll-box" style="background-color: #eff6ff;"><div id="todoSheet" class="scroll-content"></div></div></div>
            </div>
            <div class="column w-1/3">
                <div class="card h-1/2"><h2 class="card-title text-green-500">ğŸ“¦ ë‚©í’ˆ ëª©ë¡</h2><div class="scroll-box"><div id="delivery" class="scroll-content"></div></div></div>
                <div class="card h-1/2 border-t-[6px] border-teal-500"><h2 class="card-title text-teal-600">ğŸ“Š ì§„í–‰ í˜„í™© ëª©ë¡</h2><div class="scroll-box" id="statusBoxContainer" style="background-color: #f0fdfa;"><div id="statusList" class="scroll-content"></div></div></div>
            </div>
        </div>
        <div class="flex gap-4" style="height: 35%;">
            <div class="card w-1/3"><h2 class="card-title text-purple-600">ğŸ“Š BBT</h2><div class="scroll-box"><div id="shareBBT" class="scroll-content"></div></div></div>
            <div class="card w-1/3"><h2 class="card-title text-orange-600">ğŸ”§ ì¸ì„œíŠ¸</h2><div class="scroll-box"><div id="shareInsert" class="scroll-content"></div></div></div>
            <div class="card w-1/3"><h2 class="card-title text-teal-600">âš ï¸ ë¦¬í„°ì¹˜</h2><div class="scroll-box"><div id="shareRetouch" class="scroll-content"></div></div></div>
        </div>
    </div>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTmOR1Hvcso4G0weHKCXvPpy9enUYo2mX0NIECrY7TDbjDfR_hf1fEBBUBM0qY1Pd8pL1HFFfqex88Z/pub?output=csv';
        let alertConfig = { msg: "", start: 0, end: 0 };

        const clean = (str) => {
            if (!str) return "";
            return str.replace(/^"|"$/g, '').trim().split('//').join('\n');
        };

        // ì´ë¯¸ì§€ ì£¼ì†Œì¸ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        function isImageUrl(url) {
            return (url.match(/\.(jpeg|jpg|gif|png|webp)$/) != null) || url.includes('drive.google.com') || url.startsWith('http');
        }

        function updateScrollAnimation(elementId) {
            const content = document.getElementById(elementId);
            const container = content.parentElement;
            if (content.scrollHeight > container.clientHeight) {
                content.classList.add('animate-scroll');
            } else {
                content.classList.remove('animate-scroll');
            }
        }

        async function loadData() {
            try {
                const res = await fetch(`${SHEET_URL}&t=${Date.now()}`);
                const text = await res.text();
                const rows = text.split('\n');
                const getVal = (idx) => {
                    if(!rows[idx]) return "";
                    let val = rows[idx].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/)[1];
                    return clean(val);
                };

                // ì—°ì¥ì¸ì› ë“± ìƒë‹¨ ë°ì´í„°
                const v1 = getVal(0); document.getElementById('otBBT').value = v1;
                const v2 = getVal(1); document.getElementById('otInsert').value = v2;
                const v3 = getVal(2); document.getElementById('otRetouch').value = v3;

                // ê³µí†µ í…ìŠ¤íŠ¸ ë°•ìŠ¤ ì—…ë°ì´íŠ¸
                const ids = ['notice', 'attendance', 'delivery', 'todoSheet', 'shareBBT', 'shareInsert', 'shareRetouch'];
                ids.forEach((id, idx) => {
                    const val = (idx < 3) ? getVal(idx + 4) : (idx == 3) ? getVal(7) : getVal(idx + 6);
                    document.getElementById(id).innerText = val;
                    updateScrollAnimation(id);
                });

                // ì§„í–‰ í˜„í™© ëª©ë¡ íŠ¹ë³„ ì²˜ë¦¬ (ì´ë¯¸ì§€ vs í…ìŠ¤íŠ¸)
                const statusData = getVal(8);
                const statusList = document.getElementById('statusList');
                if (statusData.startsWith('http')) {
                    statusList.innerHTML = `<img src="${statusData}" class="status-img" onerror="this.src='https://via.placeholder.com/400x200?text=Image+Load+Error'">`;
                    statusList.classList.remove('animate-scroll');
                } else {
                    statusList.innerText = statusData;
                    updateScrollAnimation('statusList');
                }

                document.getElementById('scrollingNotice').innerText = getVal(3).replace(/\n/g, " | ");

                // íŒì—… ì„¤ì •
                alertConfig.msg = getVal(12);
                alertConfig.start = parseInt(getVal(13).toString().replace(":", ""));
                alertConfig.end = parseInt(getVal(14).toString().replace(":", ""));

            } catch (e) { console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨"); }
        }

        function checkSmartAlert() {
            const now = new Date();
            const currentTime = now.getHours() * 100 + now.getMinutes();
            const alertEl = document.getElementById('alertBanner');
            if (alertConfig.msg && currentTime >= alertConfig.start && currentTime <= alertConfig.end) {
                alertEl.innerText = alertConfig.msg;
                alertEl.style.display = 'block';
            } else {
                alertEl.style.display = 'none';
            }
        }

        function init() {
            setInterval(() => {
                const now = new Date();
                document.getElementById('clockDisplay').innerText = now.toLocaleString('ko-KR');
                checkSmartAlert();
            }, 1000);
            loadData();
            setInterval(loadData, 30000);
        }
        window.onload = init;
    </script>
</body>
</html>