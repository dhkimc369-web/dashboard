<script>
    // 1. 위에서 복사한 새 웹 앱 URL을 여기에 꼭 넣어주세요!
    const API_URL = 'https://script.google.com/macros/s/AKfycbzUbeugh-Qkba1DfMsZrhbEdQe9WSJ48SNraswIhgIN9HWRe486g06V-HV_aI1kCrV2dA/exec'; 

    async function loadData() {
        try {
            // 캐시를 방지하기 위해 주소 뒤에 시간을 붙여서 호출합니다.
            const response = await fetch(API_URL + '?t=' + new Date().getTime(), { redirect: 'follow' });
            const data = await response.json();
            
            if (data && data.length > 0) {
                // 1~3행: 연장 인원 업데이트 (변동 시 효과 추가)
                updateValueWithEffect('otBBT', data[0], 'cardBBT');
                updateValueWithEffect('otInsert', data[1], 'cardInsert');
                updateValueWithEffect('otRetouch', data[2], 'cardRetouch');

                // 4행: 전광판 업데이트
                const marquee = document.getElementById('scrollingNotice');
                const newNotice = (data[3] || "현재 공지 사항이 없습니다.").replace(/<br>/g, " | ");
                if(marquee.innerHTML !== newNotice) marquee.innerHTML = newNotice;

                // 5~12행: 박스 내용 업데이트 및 스크롤 적용
                for(let i=4; i<12; i++) {
                    const rowId = "row" + (i + 1);
                    const target = document.getElementById(rowId);
                    if(target) {
                        target.innerHTML = data[i] || " ";
                    }
                }
            }
        } catch (e) {
            console.error("데이터 동기화 실패:", e);
        }
    }

    // 인원 변동 시 노란색으로 깜빡이는 효과 함수
    function updateValueWithEffect(id, newVal, cardId) {
        const el = document.getElementById(id);
        const card = document.getElementById(cardId);
        if(el.innerText !== String(newVal)) {
            el.innerText = newVal;
            if(card) {
                card.style.backgroundColor = '#fbbf24'; // 노란색 강조
                setTimeout(() => { card.style.backgroundColor = '#ffffff'; }, 1000);
            }
        }
    }

    // 20초마다 자동으로 데이터를 새로고침합니다.
    setInterval(loadData, 20000);
</script>